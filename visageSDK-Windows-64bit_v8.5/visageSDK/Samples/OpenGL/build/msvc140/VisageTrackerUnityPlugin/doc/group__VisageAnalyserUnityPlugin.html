<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VisageTrackerUnityPlugin: VisageAnalyserUnityPlugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VisageTrackerUnityPlugin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">VisageAnalyserUnityPlugin</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides high-level functions for using visage|SDK face analysis capabilities in Unity game engine.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gab6fe3be5a70f06a3397d887cf8c518a8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VisageAnalyserUnityPlugin.html#gab6fe3be5a70f06a3397d887cf8c518a8">_initAnalyser</a> (string dataPath)</td></tr>
<tr class="memdesc:gab6fe3be5a70f06a3397d887cf8c518a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialises VisageFaceAnalyser.  <a href="#gab6fe3be5a70f06a3397d887cf8c518a8">More...</a><br /></td></tr>
<tr class="separator:gab6fe3be5a70f06a3397d887cf8c518a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad87c86990050425a2964161ea3f9a142"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VisageAnalyserUnityPlugin.html#gad87c86990050425a2964161ea3f9a142">_releaseAnalyser</a> ()</td></tr>
<tr class="memdesc:gad87c86990050425a2964161ea3f9a142"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases memory allocated by the face analyser in the <a class="el" href="group__VisageAnalyserUnityPlugin.html#gab6fe3be5a70f06a3397d887cf8c518a8" title="Initialises VisageFaceAnalyser. ">_initAnalyser()</a> function.  <a href="#gad87c86990050425a2964161ea3f9a142">More...</a><br /></td></tr>
<tr class="separator:gad87c86990050425a2964161ea3f9a142"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4586b6478259cb8da98e64aa82267a16"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VisageAnalyserUnityPlugin.html#ga4586b6478259cb8da98e64aa82267a16">_estimateEmotion</a> (float[] emotions, int faceIndex)</td></tr>
<tr class="memdesc:ga4586b6478259cb8da98e64aa82267a16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates emotion from a facial image.  <a href="#ga4586b6478259cb8da98e64aa82267a16">More...</a><br /></td></tr>
<tr class="separator:ga4586b6478259cb8da98e64aa82267a16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85c89f20f2612a7179dbaf7d2a7135cd"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VisageAnalyserUnityPlugin.html#ga85c89f20f2612a7179dbaf7d2a7135cd">_estimateAge</a> (int faceIndex)</td></tr>
<tr class="memdesc:ga85c89f20f2612a7179dbaf7d2a7135cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates age from a facial image.  <a href="#ga85c89f20f2612a7179dbaf7d2a7135cd">More...</a><br /></td></tr>
<tr class="separator:ga85c89f20f2612a7179dbaf7d2a7135cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaff117a62dd0c32b9d80aa299fb019838"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VisageAnalyserUnityPlugin.html#gaff117a62dd0c32b9d80aa299fb019838">_estimateGender</a> (int faceIndex)</td></tr>
<tr class="memdesc:gaff117a62dd0c32b9d80aa299fb019838"><td class="mdescLeft">&#160;</td><td class="mdescRight">Estimates gender from a facial image.  <a href="#gaff117a62dd0c32b9d80aa299fb019838">More...</a><br /></td></tr>
<tr class="separator:gaff117a62dd0c32b9d80aa299fb019838"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadbeeb0b9f5907e2e7dbc14be286b0dcf"><td class="memItemLeft" align="right" valign="top"><a id="gadbeeb0b9f5907e2e7dbc14be286b0dcf"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__VisageAnalyserUnityPlugin.html#gadbeeb0b9f5907e2e7dbc14be286b0dcf">_prepareDataForAnalysis</a> ()</td></tr>
<tr class="memdesc:gadbeeb0b9f5907e2e7dbc14be286b0dcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares data obtained by the track function. <br /></td></tr>
<tr class="separator:gadbeeb0b9f5907e2e7dbc14be286b0dcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Provides high-level functions for using visage|SDK face analysis capabilities in Unity game engine. </p>
<p>It implements high-level wrapper functions from visage|SDK that enable usage of visage|SDK face analysis capabilities in Unity C# scripts.</p>
<p>VisageFaceAnalyser contains face analysis algorithms for estimating age, gender and emotion from frontal facial images(yaw between -20 and 20 degrees).</p>
<p>The functionality of VisageFaceAnalyser is dependent on the VisageTracker and it is expected that prior to the call of VisageFaceAnalyser's functions frame is processed with <a class="el" href="group__VisageTrackerUnityPlugin.html#ga5a27b9d24dcd26e104091440348d154a" title="Performs face tracking on current frame. ">_track()</a> function and the data thus obtained is prepared and forwarded to VisageFaceAnalyser.</p>
<p>Before using VisageFaceAnalyser, it must be initialized by calling the <a class="el" href="group__VisageAnalyserUnityPlugin.html#gab6fe3be5a70f06a3397d887cf8c518a8" title="Initialises VisageFaceAnalyser. ">_initAnalyser()</a> function. Afterward, in each frame, the <a class="el" href="group__VisageAnalyserUnityPlugin.html#gadbeeb0b9f5907e2e7dbc14be286b0dcf" title="Prepares data obtained by the track function. ">_prepareDataForAnalysis()</a> function is called first and then the functions for estimating the age, gender and emotions, otherwise -1 will be returned as an indication that the estimation failed.</p>
<p>VisageFaceAnalyser's functionality can be used in a separate thread.</p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga85c89f20f2612a7179dbaf7d2a7135cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga85c89f20f2612a7179dbaf7d2a7135cd">&#9670;&nbsp;</a></span>_estimateAge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float _estimateAge </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>faceIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimates age from a facial image. </p>
<p>In case of multiple trackers running faceIndex specifies tracker ID.</p>
<p>The function returns estimated age. Prior to using this function, it is necessary to process the video frame using <a class="el" href="group__VisageTrackerUnityPlugin.html#ga5a27b9d24dcd26e104091440348d154a" title="Performs face tracking on current frame. ">_track()</a> function and prepare obtained data with <a class="el" href="group__VisageAnalyserUnityPlugin.html#gadbeeb0b9f5907e2e7dbc14be286b0dcf" title="Prepares data obtained by the track function. ">_prepareDataForAnalysis()</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">faceIndex</td><td>Value between 0 and MAX_FACES-1, used to access the data of a particular tracked face. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Estimated age or -1 if it failed. </dd></dl>

</div>
</div>
<a id="ga4586b6478259cb8da98e64aa82267a16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4586b6478259cb8da98e64aa82267a16">&#9670;&nbsp;</a></span>_estimateEmotion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _estimateEmotion </td>
          <td>(</td>
          <td class="paramtype">float []&#160;</td>
          <td class="paramname"><em>emotions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>faceIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimates emotion from a facial image. </p>
<p>In case of multiple trackers running faceIndex specifies tracker ID.</p>
<p>The function returns estimated probabilities for basic emotions. Prior to using this function, it is necessary to process the video frame using <a class="el" href="group__VisageTrackerUnityPlugin.html#ga5a27b9d24dcd26e104091440348d154a" title="Performs face tracking on current frame. ">_track()</a> function and prepare obtained data with <a class="el" href="group__VisageAnalyserUnityPlugin.html#gadbeeb0b9f5907e2e7dbc14be286b0dcf" title="Prepares data obtained by the track function. ">_prepareDataForAnalysis()</a> function.</p>
<p>An example of use: </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">float</span>[,] Emotions = <span class="keyword">new</span> <span class="keywordtype">float</span>[MAX_FACES, NUM_EMOTIONS];</div><div class="line"><span class="keyword">public</span> <span class="keywordtype">float</span>[] emotions = <span class="keyword">new</span> <span class="keywordtype">float</span>[7];</div><div class="line"></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; MAX_FACES; ++i)</div><div class="line">{</div><div class="line">   <span class="keywordtype">int</span> success = VisageTrackerNative._estimateEmotion(emotions, i);</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span>(success)</div><div class="line">   {</div><div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; emotions.Length; j++)</div><div class="line">       {</div><div class="line">           Emotions[i, j] = emotions[i];</div><div class="line">       }</div><div class="line">   }</div><div class="line">}  </div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">emotions</td><td>An array of 7 floats. If successful, the function will fill this array with estimated probabilities for emotions in this order: anger, disgust, fear, happiness, sadness, surprise and neutral. Each probability will have a value between 0 and 1. Sum of probabilities does not have to be 1. </td></tr>
    <tr><td class="paramname">faceIndex</td><td>Value between 0 and MAX_FACES-1, used to access the data of a particular tracked face. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if estimation was successful or -1 if it failed. </dd></dl>

</div>
</div>
<a id="gaff117a62dd0c32b9d80aa299fb019838"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaff117a62dd0c32b9d80aa299fb019838">&#9670;&nbsp;</a></span>_estimateGender()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _estimateGender </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>faceIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Estimates gender from a facial image. </p>
<p>In case of multiple trackers running faceIndex specifies tracker ID.</p>
<p>The function returns 1 if estimated gender is male and 0 if it is a female. Prior to using this function, it is necessary to process the video frame using <a class="el" href="group__VisageTrackerUnityPlugin.html#ga5a27b9d24dcd26e104091440348d154a" title="Performs face tracking on current frame. ">_track()</a> function and prepare obtained data with <a class="el" href="group__VisageAnalyserUnityPlugin.html#gadbeeb0b9f5907e2e7dbc14be286b0dcf" title="Prepares data obtained by the track function. ">_prepareDataForAnalysis()</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">faceIndex</td><td>Value between 0 and MAX_FACES-1, used to access the data of a particular tracked face. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if estimated gender is female, 1 if it is a male and -1 if it failed. </dd></dl>

</div>
</div>
<a id="gab6fe3be5a70f06a3397d887cf8c518a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab6fe3be5a70f06a3397d887cf8c518a8">&#9670;&nbsp;</a></span>_initAnalyser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _initAnalyser </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>dataPath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialises VisageFaceAnalyser. </p>
<p>This function must be called before using VisageFaceAnalyser by passing it a path to the folder containing the VisageFaceAnalyser data files. Within the Visage|SDK package, this folder is Samples/data/bdtsdata/LBF/vfadata. The VisageFaceAnalyser data folder contains the following subfolders corresponding to the various types of analysis that can be performed:</p>
<ul>
<li>
ad: age estimation </li>
<li>
gd: gender estimation </li>
<li>
ed: emotion estimation </li>
</ul>
<p>An example of use: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> analysisDataLoaded = 0;</div><div class="line"><span class="keywordtype">int</span> analyserInited = VisageTrackerNative._initAnalyser(dataPath);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> ((analyserInited &amp; (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_AGE) == (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_AGE)</div><div class="line">{</div><div class="line">   analysisDataLoaded |= (int)VFA_FLAGS.VFA_AGE;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> ((analyserInited &amp; (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_EMOTION) == (int)VFA_FLAGS.VFA_EMOTION)</div><div class="line">{</div><div class="line">   analysisDataLoaded |= (int)VFA_FLAGS.VFA_EMOTION;</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keywordflow">if</span> ((analyserInited &amp; (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_GENDER) == (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_GENDER)</div><div class="line">{</div><div class="line">   analysisDataLoaded |= (int)VFA_FLAGS.VFA_GENDER;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIndex = 0; faceIndex &lt; MAX_FACES; faceIndex++)</div><div class="line">{</div><div class="line">   <span class="keywordflow">if</span> ((analysisDataLoaded &amp; (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_AGE) == (<span class="keywordtype">int</span>)VFA_FLAGS.VFA_AGE)</div><div class="line">       age[faceIndex] = VisageTrackerNative._estimateAge(faceIndex);</div><div class="line">}</div></div><!-- fragment --><p>Note that it is not necessary for all subfolders to be present, only the ones needed by the types of analysis that will be performed. For example, if only gender estimation will be performed, then only the gd folder is required. The return value of the function indicates which types of analysis have been successfully initialised. Subsequent attempt to use a type of analysis that was not initialized shall fail; for example, if only gd folder was present at initialization, attempt to use <a class="el" href="group__VisageAnalyserUnityPlugin.html#ga4586b6478259cb8da98e64aa82267a16" title="Estimates emotion from a facial image. ">_estimateEmotion()</a> shall fail. The return value is a bitwise combination of flags indicating which types of analysis are successfully initialized.</p>
<p>Please note that in order for license to be registered, <a class="el" href="group__VisageTrackerUnityPlugin.html#ga3922faf5bcffa475f9ebedc3140fbd90" title="Initializes the license. ">_initializeLicense()</a> method has to be called before.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dataPath</td><td>Relative path from the working directory to the directory that contains VisageFaceAnalyser data files (e.g. Application.streamingAssetsPath + /Visage Tracker/bdtsdata/LBF/vfadata"). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The return value of 0 indicates that no data files are found and no analysis will be possible. In such case, the placement of data files should be verified. A non-zero value indicates that one or more types of analysis are successfully initialized. The specific types of analysis that have been initialized are indicated by a bitwise combination of the following flags: VFA_AGE, VFA_GENDER, VFA_EMOTION. </dd></dl>

</div>
</div>
<a id="gad87c86990050425a2964161ea3f9a142"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad87c86990050425a2964161ea3f9a142">&#9670;&nbsp;</a></span>_releaseAnalyser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _releaseAnalyser </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases memory allocated by the face analyser in the <a class="el" href="group__VisageAnalyserUnityPlugin.html#gab6fe3be5a70f06a3397d887cf8c518a8" title="Initialises VisageFaceAnalyser. ">_initAnalyser()</a> function. </p>
<p>This function is called after the analyser ceases to be used or before the reinitialization of the analyser. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 14 2019 14:47:49 for VisageTrackerUnityPlugin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
